<header><input type="checkbox"> I'll will post my translation on the <a href='http://rejetto.com/forum/index.php?topic=13313.0'>forum</a></header><br>
<select >
 <option value="">en</option>
 <optgroup label='default'>
 <option value="dj0001/hfs-template/master/addons/languages/default/es.txt" title='*Leo'>es*</option>
 <option value="dj0001/hfs-template/master/addons/languages/default/zh.txt" title='*NaitLee'>zh*</option>
 </optgroup>
 <optgroup label='light'>
 <option value="dj0001/hfs-template/master/addons/languages/es.txt">es</option>
 <option value="dj0001/hfs-template/master/addons/languages/de.txt">de</option>
 <option value="dj0001/hfs-template/master/addons/languages/fr.txt">fr</option>
 <option value="dj0001/hfs-template/master/addons/languages/zh.txt">zh</option>
 </optgroup>
</select>
<a hidden ></a>
<button>Download</button> <a></a>

<script>
const difftpl=false  //edit here

document.querySelector('button').onclick=get
var adr=location.search.slice(1) || 'https://raw.githubusercontent.com/dj0001/hfs-template/gh-pages/mobil-light_V5.5.tpl'
adr=decodeURIComponent(adr)
document.querySelector('button~a').textContent=adr.replace('https://raw.githubusercontent.com/','')
document.querySelector('button~a').href='https://github.com/'+document.querySelector('button~a').textContent.replace(/.+?\/.+?\//,'$&blob/')

var txt0='', a=document.querySelector('a[hidden]')
a.download='language_en'+(difftpl?'.diff.tpl':'.txt')

document.querySelector('select').onchange=function(){
 a.download='language_'+this.selectedOptions[0].text+(difftpl? '.diff.tpl':'.txt')
 if(this.value) fetch('https://raw.githubusercontent.com/'+this.value).then(res => res.text()).then(txt => {txt0=txt; this.selectedOptions[0].title=txt.match(/\n/g).length+' items'});
  else txt0=''
}

function get(){
 if(!document.querySelector('input').checked) {alert('First accept the terms of use'); return}  //
 fetch(adr).then(res => {if(!res.ok) throw Error('404'); return res.text()})
  .then(txt => {
 txt=txt.replace('{.!%reason%.}','{.!File name or extension forbidden..}')  //
 txt=txt.replace('{.!{.if|{.length|{.?search.}.}|No results|No files.}.}','{.if|{.length|{.?search.}.}|{:{.!No results.}:}|{:{.!No files.}:}.}')  //fixed manually
 var lng=txt.match(/{\.!.+?\.}/g)
 var uniq = [...new Set(lng)];  //remove duplicates
 var txt = difftpl? '[+special:strings]\r\n':''
 uniq.forEach(it => { if(!it.startsWith('option.',3)) txt += it.slice(3,-2)+'='+(txt0.match(it.slice(3,-2)+'=(.+)')||[,''])[1]+'\r\n' })  //remove special:strings
 console.log((txt.match(/=\r\n/g)||[]).length+'('+txt.match(/\n/g).length+') not translated')  //
 txt=new Blob([txt],{type:'text/plain'}); a.href=URL.createObjectURL(txt); a.click()
  } )
}
</script>
