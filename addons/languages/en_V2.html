<style>input:not(:checked)~button{pointer-events:none}</style>

<input type="checkbox" checked> I'll will post my translation on the <a href='http://rejetto.com/forum/index.php?topic=13313.0'>forum</a><br><br>
<select >
 <option value="">en</option>
 <optgroup label='default'>
 <option value="dj0001/hfs-template/master/addons/languages/default/es.txt" title='*Leo'>es*</option>
 <option value="dj0001/hfs-template/master/addons/languages/default/zh.txt" title='*NaitLee'>zh*</option>
 <option value="dj0001/hfs-template/master/addons/languages/default/de.txt" title='*translations are welcome' disabled>*de</option>
 <option value="dj0001/hfs-template/master/addons/languages/default/it.txt" title='*translations are welcome' disabled>*it</option>
 <option value="dj0001/hfs-template/master/addons/languages/default/ru.txt" title='*translations are welcome' disabled>*ru</option>
</optgroup>
 <optgroup label='light'>
 <option value="dj0001/hfs-template/master/addons/languages/es.txt">es</option>
 <option value="dj0001/hfs-template/master/addons/languages/de.txt">de</option>
 <option value="dj0001/hfs-template/master/addons/languages/fr.txt">fr</option>
 <option value="dj0001/hfs-template/master/addons/languages/zh.txt">zh</option>
 </optgroup>
</select>
<a hidden ></a>
<button title="Download&#xa;&#x2196;&#x2261; .diff.tpl"  id='button'></button> <a></a>

<script>
var difftpl=false  //edit here

document.querySelector('button').onclick=get
var adr=location.search.slice(1) || 'https://raw.githubusercontent.com/dj0001/hfs-template/gh-pages/mobil-light_V5.5.tpl'
adr=decodeURIComponent(adr)
document.querySelector('button~a').textContent=adr.replace('https://raw.githubusercontent.com/','')
document.querySelector('button~a').href='https://github.com/'+document.querySelector('button~a').textContent.replace(/.+?\/.+?\//,'$&blob/')

var txt0='', a=document.querySelector('a[hidden]')

document.querySelector('select').onchange=function(){
 a.download=this.selectedOptions[0].text+(difftpl? '.diff.tpl':'.txt')  //'_lng
 if(this.value) fetch('https://raw.githubusercontent.com/'+this.value).then(res => res.text()).then(txt => {txt0=txt; this.selectedOptions[0].title=txt.match(/\n/g).length+' items'});
  else txt0=''
}

document.querySelector('select').selectedIndex=Math.max([...document.querySelector('select').options].findIndex(el => el.text.slice(0,2)==navigator.language.split('-')[0]),0)  //
document.querySelector('select').onchange()
const i18={en:'Download', es:'Descargar', zh:'下载'}; document.querySelector('#button').textContent=i18[navigator.language.split('-')[0]]||i18['en']  //
 
function get(){
 fetch(adr).then(res => {if(!res.ok) throw Error('404'); return res.text()})
  .then(txt => {
 txt=txt.replace('{.!%reason%.}','{.!File name or extension forbidden..}')  //
 txt=txt.replace('{.!{.if|{.length|{.?search.}.}|No results|No files.}.}','{.if|{.length|{.?search.}.}|{:{.!No results.}:}|{:{.!No files.}:}.}')  //fixed manually
 var lng=txt.match(/{\.!.+?\.}/g)
 var uniq = [...new Set(lng)];  //remove duplicates
 var txt =  '[+special:strings]\r\n'  //difftpl? '[+special:strings]\r\n':''
 uniq.forEach(it => { if(!it.startsWith('option.',3)) txt += it.slice(3,-2)+'='+(txt0.match(it.slice(3,-2)+'=(.+)')||[,''])[1]+'\r\n' })  //remove special:strings
 console.log((txt.match(/=\r\n/g)||[]).length+'('+txt.match(/\n/g).length+') not translated')  //
 txt=txt.replace(/(max s dl msg=)\r\n/,'$1There is a limit on the number of simultaneous downloads on this server\r\n')  //
 txt +=  (txt0.match('# ©\\w+')||'#') +  " don't forget to post your translation\r\n"  //
 txt=new Blob([txt],{type:'text/plain'}); a.href=URL.createObjectURL(txt); a.click()
  } )
}

document.querySelector('#button').oncontextmenu=function(){difftpl=!difftpl; this.title=difftpl?'.diff.tpl':'.txt' ; document.querySelector('select').onchange(); return false}  //
</script>
